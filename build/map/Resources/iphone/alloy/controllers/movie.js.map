{"version":3,"sources":["template.js","app/controllers/movie.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AD3NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/Users/samueleast/Documents/Appcelerator_Studio_Workspace/OTNet/Resources/iphone/alloy/controllers/movie.js","sourceRoot":"/Users/samueleast/Documents/Appcelerator_Studio_Workspace/OTNet","sourcesContent":["var Alloy = require('/alloy'),\n\tBackbone = Alloy.Backbone,\n\t_ = Alloy._;\n\n\n\n\nfunction __processArg(obj, key) {\n\tvar arg = null;\n\tif (obj) {\n\t\targ = obj[key] || null;\n\t}\n\treturn arg;\n}\n\nfunction Controller() {\n\t\n\trequire('/alloy/controllers/' + 'BaseController').apply(this, Array.prototype.slice.call(arguments));\n\tthis.__controllerPath = 'movie';\n\tthis.args = arguments[0] || {};\n\n\tif (arguments[0]) {\n\t\tvar __parentSymbol = __processArg(arguments[0], '__parentSymbol');\n\t\tvar $model = __processArg(arguments[0], '$model');\n\t\tvar __itemTemplate = __processArg(arguments[0], '__itemTemplate');\n\t}\n\tvar $ = this;\n\tvar exports = {};\n\tvar __defers = {};\n\n\t// Generated code that must be executed before all UI and/or\n\t// controller code. One example is all model and collection\n\t// declarations from markup.\n\t\n\n\t// Generated UI code\n\t$.__views.window = Ti.UI.createWindow(\n{navBarHidden:true,backgroundColor:\"black\",orientationModes:[Ti.UI.PORTRAIT,],clipMode:true,id:\"window\",}\n);\n$.__views.window && $.addTopLevelView($.__views.window);\n$.__views.background_imageview = Ti.UI.createImageView(\n{top:0,left:Alloy.Globals.layout.movie.backdropImageLeft,width:Alloy.Globals.layout.movie.backdropImageWidth,height:Alloy.Globals.layout.movie.backdropImageHeight,preventDefaultImage:true,opacity:0,id:\"background_imageview\",}\n);\n$.__views.window.add($.__views.background_imageview);\n$.__views.background_gradient_view = Ti.UI.createView(\n{top:0,left:Alloy.Globals.layout.movie.backdropImageLeft,width:Alloy.Globals.layout.movie.backdropImageWidth,height:Alloy.Globals.layout.movie.backdropImageHeight,backgroundGradient:{type:\"linear\",startPoint:{x:\"0%\",y:\"0%\",},endPoint:{x:\"0%\",y:\"100%\",},colors:[{color:\"#77000000\",offset:0,},{color:\"#77000000\",offset:0.5,},{color:\"#ff000000\",offset:0.9,},],},id:\"background_gradient_view\",}\n);\n$.__views.window.add($.__views.background_gradient_view);\n$.__views.details_scrollview = Ti.UI.createScrollView(\n{top:0,left:0,width:Alloy.Globals.Device.width,height:Ti.UI.FILL,contentWidth:\"auto\",contentHeight:\"auto\",layout:\"vertical\",opacity:0,id:\"details_scrollview\",}\n);\n$.__views.window.add($.__views.details_scrollview);\n$.__views.title_label = Ti.UI.createLabel(\n{top:Alloy.Globals.layout.movie.titleTop,left:10,right:10,height:Ti.UI.SIZE,font:{fontSize:28,fontFamily:\"HelveticaNeue-Bold\",},color:\"#ffffff\",id:\"title_label\",}\n);\n$.__views.details_scrollview.add($.__views.title_label);\n$.__views.details_view = Ti.UI.createView(\n{top:Alloy.Globals.layout.movie.detailsTop,left:10,right:10,height:Ti.UI.SIZE,id:\"details_view\",}\n);\n$.__views.details_scrollview.add($.__views.details_view);\n$.__views.poster = Ti.UI.createView(\n{top:0,left:0,width:Alloy.Globals.layout.movie.posterWidth,height:Alloy.Globals.layout.movie.posterHeight,id:\"poster\",}\n);\n$.__views.details_view.add($.__views.poster);\n$.__views.poster_imageview = Ti.UI.createImageView(\n{borderColor:\"#66ffffff\",borderWidth:0.5,width:Alloy.Globals.layout.movie.posterWidth,height:Alloy.Globals.layout.movie.posterHeight,preventDefaultImage:true,id:\"poster_imageview\",}\n);\n$.__views.poster.add($.__views.poster_imageview);\n$.__views.poster_overlay_view = Ti.UI.createView(\n{backgroundColor:\"#ffffff\",opacity:0,id:\"poster_overlay_view\",}\n);\n$.__views.poster.add($.__views.poster_overlay_view);\n$.__views.play_button = Ti.UI.createButton(\n{width:Alloy.Globals.layout.movie.posterWidth,height:Alloy.Globals.layout.movie.posterHeight,backgroundImage:\"/play_button.png\",backgroundSelectedImage:\"/play_button_down.png\",id:\"play_button\",}\n);\n$.__views.poster.add($.__views.play_button);\n$.__views.rightSide = Ti.UI.createView(\n{width:Alloy.Globals.layout.movie.infoWidth,height:Ti.UI.SIZE,top:0,right:0,layout:\"vertical\",id:\"rightSide\",}\n);\n$.__views.details_view.add($.__views.rightSide);\n$.__views.info_label = Ti.UI.createLabel(\n{top:0,left:0,width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontSize:14,fontFamily:\"HelveticaNeue-Light\",},color:\"#d0d0d0\",id:\"info_label\",}\n);\n$.__views.rightSide.add($.__views.info_label);\n$.__views.rightSideButtons = Ti.UI.createView(\n{width:Alloy.Globals.layout.movie.infoWidth,height:Ti.UI.SIZE,left:0,layout:\"horizontal\",id:\"rightSideButtons\",}\n);\n$.__views.rightSide.add($.__views.rightSideButtons);\n$.__views.website_button = Ti.UI.createButton(\n{top:10,left:0,width:Alloy.Globals.layout.movie.linkButtonWidth,height:30,backgroundColor:\"#260205\",borderColor:\"#b0332a\",borderWidth:0.5,color:\"#b0332a\",font:{fontSize:14,fontFamily:\"HelveticaNeue-Light\",},title:'Share',id:\"website_button\",}\n);\n$.__views.rightSideButtons.add($.__views.website_button);\n$.__views.imdb_button = Ti.UI.createButton(\n{top:10,left:10,width:Alloy.Globals.layout.movie.linkButtonWidth,height:30,backgroundColor:\"#260205\",borderColor:\"#b0332a\",borderWidth:0.5,color:\"#b0332a\",font:{fontSize:14,fontFamily:\"HelveticaNeue-Light\",},title:'Seasons',id:\"imdb_button\",}\n);\n$.__views.rightSideButtons.add($.__views.imdb_button);\n$.__views.info_cast = Ti.UI.createLabel(\n{left:0,top:10,width:Ti.UI.FILL,height:Ti.UI.SIZE,color:\"#d0d0d0\",font:{fontSize:14,fontFamily:\"HelveticaNeue-Light\",},id:\"info_cast\",}\n);\n$.__views.rightSide.add($.__views.info_cast);\n$.__views.info_views = Ti.UI.createLabel(\n{left:0,top:10,width:Ti.UI.FILL,height:Ti.UI.SIZE,color:\"#d0d0d0\",font:{fontSize:14,fontFamily:\"HelveticaNeue-Light\",},id:\"info_views\",}\n);\n$.__views.rightSide.add($.__views.info_views);\n$.__views.synopsis_label = Ti.UI.createLabel(\n{top:Alloy.Globals.layout.movie.synopsisTop,left:10,right:10,height:Ti.UI.SIZE,font:{fontSize:14,fontFamily:\"HelveticaNeue\",},backgroundColor:\"transparent\",color:\"#d0d0d0\",id:\"synopsis_label\",}\n);\n$.__views.details_scrollview.add($.__views.synopsis_label);\n$.__views.activity_indicator = Ti.UI.createActivityIndicator(\n{style:Ti.UI.ActivityIndicatorStyle.BIG,height:Ti.UI.SIZE,width:Ti.UI.SIZE,color:\"#ff0000\",id:\"activity_indicator\",}\n);\n$.__views.window.add($.__views.activity_indicator);\n$.__views.__alloyId0 = Alloy.createController('views/navbar',{id:\"__alloyId0\",__parentSymbol:$.__views.window,});\n$.__views.__alloyId0.setParent($.__views.window);\nexports.destroy = function () {};\n\n\t// make all IDed elements in $.__views available right on the $ in a\n\t// controller's internal code. Externally the IDed elements will\n\t// be accessed with getView().\n\t_.extend($, $.__views);\n\n\t// Controller code directly from the developer's controller file\n\t__MAPMARKER_CONTROLLER_CODE__\n\n\t// Generated code that must be executed after all UI and\n\t// controller code. One example deferred event handlers whose\n\t// functions are not defined until after the controller code\n\t// is executed.\n\t\n\n\t// Extend the $ instance with all functions and properties\n\t// defined on the exports object.\n\t_.extend($, exports);\n}\n\nmodule.exports = Controller;\n","var api = require('apiService');\nvar Data = require(\"/data\");\nvar player = require('/player');\nvar yt = require('/youtube');\nvar animation = require('/animation');\n\nvar args = arguments[0] || {};\nvar movie;\nvar code;\nvar images_loaded = 0;\nvar can_play_trailer = true;\n\n/**\n                              * init\n                              */\nfunction init() {\n\n  $.window.removeEventListener(\"open\", init);\n\n  $.activity_indicator.show();\n\n  if (args.code) {\n\n    fetchMovie(args.code);\n\n  } else if (args.movie) {\n\n    movie = args.movie;\n\n  }\n\n}\n\n/**\n   * fetch movie\n   * @param {String} id\n   */\nfunction fetchMovie(code) {\n\n  api.getService({\n    endpoint: '/v1/players?code=' + code + '&mobile=images' },\n  function (_response) {\n\n    // check for in\n    if (_response.status) {\n\n      movie = _response.data;\n      populateMovie(_response.data);\n\n    } else {\n\n      alert(_response.message);\n\n    }\n\n  });\n\n}\n\n/**\n   * populate movie\n   * @param {Object} movie\n   */\nfunction populateMovie(movie) {\n\n  $.background_imageview.image = movie.images_landscape ? movie.images_landscape : 'https://via.placeholder.com/1280x720';\n\n  $.poster_imageview.image = movie.images_portrait ? movie.images_portrait : 'https://via.placeholder.com/720x1280';\n\n  $.title_label.text = movie.title;\n  $.info_label.text = durationString(movie.duration);\n  if (movie.release_date) $.info_label.text += '  |  ' + movie.release_date.substr(0, 4);\n  var info_label_max_y = $.info_label.rect.y + $.info_label.rect.height;\n\n  if (movie.persons) {\n\n    if (movie.persons.length > 0) {\n\n      var cast = '';\n      for (var i = 0; i < movie.persons.length; i++) {\n        var comma = movie.persons.length != i + 1 ? ', ' : '';\n        cast += movie.persons[i].title + comma;\n      }\n      $.info_cast.text = 'Cast: ' + cast;\n\n    } else {\n\n      $.rightSide.remove($.info_cast);\n\n    }\n\n  }\n\n  if (movie.views) {\n\n    $.info_views.text = 'Views: ' + movie.views;\n\n  }\n\n  if (movie.hasOwnProperty('seasons')) {\n    // SHOW SEASONS BTN::\n  } else {\n    $.imdb_button.hide();\n  }\n\n  if (movie.homepage || movie.imdb_id) {\n\n    if (movie.homepage) {\n      $.website_button.top = info_label_max_y + 15;\n    } else {\n      $.details_view.remove($.website_button);\n    }\n\n    if (movie.imdb_id) {\n      if (!movie.homepage) $.imdb_button.left = $.website_button.left;\n      $.imdb_button.top = info_label_max_y + 15;\n    } else {\n      $.details_view.remove($.imdb_button);\n    }\n  }\n\n  // synopsis\n  $.synopsis_label.text = movie.long_description;\n  var synopsis_height = 0;\n  $.synopsis_label.addEventListener('postlayout', function synopsisPostLayout(e) {\n\n    if ($.synopsis_label.rect.height == synopsis_height) {\n      return;\n    }\n    synopsis_height = $.synopsis_label.rect.height;\n\n    $.details_scrollview.contentHeight = $.synopsis_label.rect.y + $.synopsis_label.rect.height + 20;\n    $.details_scrollview.contentHeight = Math.max($.details_scrollview.contentHeight, Alloy.Globals.Device.height + 1);\n  });\n\n  /*if (movie.trailer) {\n      \tcan_play_trailer = true;\n      } else {\n      \t$.poster.remove($.play_button);\n      }*/\n}\n\n/**\n   * duration in hours and minutes\n   * @param {Number} minutes\n   * @return {String}\n   */\nfunction durationString(minutes) {\n\n  var hours = Math.floor(minutes / 60);\n  minutes = minutes - hours * 60;\n  var duration = hours > 0 ? hours + \"h \" : \"\";\n  duration += minutes > 9 ? minutes + \"m\" : \"0\" + minutes + \"m\";\n  return duration;\n}\n\n/**\n   * animate in\n   */\nfunction animateIn() {\n  images_loaded++;\n  if (images_loaded < 2) return;\n\n  $.activity_indicator.hide();\n\n  var background_animation = Ti.UI.createAnimation({\n    opacity: 1,\n    duration: 1000,\n    curve: Titanium.UI.ANIMATION_CURVE_EASE_OUT });\n\n  $.background_imageview.animate(background_animation);\n\n  var details_animation = Ti.UI.createAnimation({\n    opacity: 1,\n    duration: 500,\n    delay: 800,\n    curve: Titanium.UI.ANIMATION_CURVE_EASE_OUT });\n\n  $.details_scrollview.animate(details_animation);\n}\n\n\n\n///////////////////////////////////////////////////////////////////////////////\n//\n// event handlers\n//\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * window open\n */\n$.window.addEventListener(\"open\", init);\n\n/**\n                                          * background imageview load\n                                          */\n$.background_imageview.addEventListener('load', function (e) {\n  $.background_gradient_view.height = e.source.rect.height + 2; // hacky :(\n  animateIn();\n});\n\n/**\n     * poster imageview load\n     */\n$.poster_imageview.addEventListener('load', animateIn);\n\n/**\n                                                         * scrollview scroll\n                                                         */\n$.details_scrollview.addEventListener('scroll', function (e) {\n\n  var opacity = 1.0;\n  var offset = e.y;\n\n  if (offset <= 0) {\n\n    var height = Alloy.Globals.layout.movie.backdropImageHeight - offset;\n    var scale = height / Alloy.Globals.layout.movie.backdropImageHeight;\n\n    var transform = Ti.UI.create2DMatrix({ scale: scale });\n    transform = transform.translate(0, -offset / (2 * scale));\n\n    $.background_imageview.transform = $.background_gradient_view.transform = transform;\n    $.background_imageview.opacity = 1;\n\n  } else if (offset > 0) {\n\n    opacity = Math.max(1 - offset / 200, 0.5);\n    $.background_imageview.opacity = opacity;\n  }\n\n});\n\n/**\n     * play button click\n     */\n$.play_button.addEventListener('click', function (e) {\n\n  api.getCustomerService({\n    endpoint: \"/v1/access\" },\n  function (_response) {\n\n    if (_response.status) {\n\n      // LOGGED IN\n      $.play_button.touchEnabled = false;\n      animation.flash($.poster_overlay_view, function () {\n\n        if (movie.content.media.length > 0) {\n\n          var getTypes = movie.content.media.filter(function (val) {\n\n            return val.mime_type == \"application/x-mpegURL\";\n\n          });\n\n          if (getTypes.length > 0) {\n\n            var source = getTypes.filter(function (val) {\n              return val.ref == \"app\";\n            });\n\n            if (source.length > 0) {\n\n              player.playVideo(source[0].src, args.code);\n\n            } else {\n\n              player.playVideo(getTypes[0].src, args.code);\n\n            }\n\n          }\n\n        } else {\n\n          alert('No videos');\n\n        }\n\n        setTimeout(function () {\n          $.play_button.touchEnabled = true;\n        }, 2000);\n\n      });\n\n    } else {\n\n      // NOT LOGGED IN::\n      Alloy.Globals.Navigator.push(\"auth\", {});\n\n    }\n\n  });\n\n});\n\n/**\n     * website button click\n     */\n$.website_button.addEventListener('click', function (e) {\n  if (movie.homepage) {\n\n    Ti.Platform.openURL(movie.homepage);\n\n  }\n});\n\n/**\n     * IMDB button click\n     */\n$.imdb_button.addEventListener('click', function (e) {\n\n  var seasonsOptions = [];\n  var seasonsArray = [];\n  if (movie.seasons) {\n\n    for (var i = 0; i < movie.seasons.length; i++) {\n\n      seasonsOptions.push(movie.seasons[i].title);\n      seasonsArray.push(movie.seasons[i]);\n\n    }\n\n  }\n\n  var dialog = Ti.UI.createOptionDialog({\n    options: seasonsOptions,\n    title: 'Seasons' });\n\n  dialog.addEventListener('click', function (evt) {\n\n    Alloy.Globals.Navigator.push(\"movies_list\", {\n      type: 'season',\n      id: seasonsArray[evt.index].id,\n      title: seasonsArray[evt.index].title });\n\n\n  });\n  dialog.show();\n\n});"]}